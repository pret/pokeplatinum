#include <nitro.h>
#include <string.h>

#include "struct_decls/struct_02025E6C_decl.h"
#include "struct_defs/pokemon.h"
#include "struct_decls/struct_party_decl.h"
#include "struct_decls/struct_021C0794_decl.h"

#include "struct_defs/struct_0202D764.h"
#include "struct_defs/struct_0204AFC4.h"
#include "struct_defs/struct_0204B184.h"
#include "struct_defs/struct_0204B1E8.h"
#include "struct_defs/struct_0204B404.h"
#include "overlay006/battle_params.h"
#include "overlay104/struct_ov104_02230BE4.h"
#include "overlay104/struct_ov104_0223A348.h"
#include "overlay104/struct_ov104_0223A348_sub1.h"
#include "overlay104/struct_ov104_0223A348_sub2.h"

#include "unk_0200AC5C.h"
#include "heap.h"
#include "unk_02025E68.h"
#include "unk_0202D05C.h"
#include "unk_020329E0.h"
#include "unk_02049D08.h"
#include "unk_02051D8C.h"
#include "unk_02073C2C.h"
#include "party.h"
#include "overlay104/ov104_0222DCE0.h"
#include "overlay104/ov104_0223A0C4.h"

const UnkStruct_ov104_0223A348_sub2 Unk_ov104_0223FE30[] = {
	{
		0x1,
		0x0,
		0xEA,
		{ 0x16, 0x4B, 0xEB, 0x4C },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x86, 0x68, 0x5f, 0x71, 0x7E, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x4,
		0x0,
		0xFD,
		{ 0x34, 0x53, 0x35, 0x7E },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x83, 0x79, 0x5C, 0x63, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x7,
		0x0,
		0xF3,
		{ 0x37, 0x39, 0x160, 0x38 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x6D, 0x7C, 0x5D, 0x92, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x7B,
		0x0,
		0xDD,
		{ 0x13E, 0xD3, 0x68, 0x13A },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x6A, 0x79, 0x9A, 0x55, 0x60, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x16B,
		0x0,
		0xF6,
		{ 0x12D, 0x160, 0x102, 0xBD },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x70, 0x8f, 0x67, 0x9A, 0x68, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x51,
		0x0,
		0x99,
		{ 0x15F, 0x30, 0x13F, 0x73 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x64, 0x55, 0x9C, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x12C,
		0x0,
		0xD9,
		{ 0x2F, 0x139, 0xCC, 0x3 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x59, 0x7E, 0x64, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x128,
		0x0,
		0xE8,
		{ 0xFC, 0x45, 0xC5, 0x12 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x8f, 0x60, 0x7f, 0x68, 0x70, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0xA7,
		0x0,
		0xC9,
		{ 0x144, 0x65, 0xA9, 0xB8 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x55, 0x79, 0x8f, 0x9C, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x1B,
		0x0,
		0xED,
		{ 0x5B, 0x13D, 0xC9, 0x1C },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x66, 0xA1, 0x7A, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x114,
		0x0,
		0xCB,
		{ 0x13, 0x62, 0x11B, 0x74 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x6A, 0x81, 0x92, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x66,
		0x0,
		0x97,
		{ 0x5D, 0xF6, 0x49, 0x71 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x70, 0x8f, 0x70, 0x8f, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x4A,
		0x0,
		0xE6,
		{ 0xDE, 0x15E, 0x46, 0xB6 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x55, 0x68, 0x75, 0x87, 0x77, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0xC8,
		0x0,
		0xD5,
		{ 0xDC, 0xF7, 0x6D, 0x56 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x91, 0x57, 0x8f, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x173,
		0x0,
		0x9D,
		{ 0xE1, 0x1D, 0x118, 0xB8 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x70, 0x75, 0x8A, 0x55, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0xE4,
		0x0,
		0xF9,
		{ 0xF2, 0x34, 0x2E, 0xB6 },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x78, 0x9C, 0x84, 0x9C, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	},
	{
		0x131,
		0x0,
		0x9E,
		{ 0xE8, 0x13D, 0x14E, 0x6A },
		0x12345678,
		0x98765432,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x1F,
		0x0,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x20,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0x0,
		0xFF,
		{ 0x64, 0x7A, 0x9A, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff }
	}
};


const UnkStruct_ov104_0223A348_sub1 Unk_ov104_0223FCE0[] = {
	{
		0x12345678,
		0x2,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA3, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0x0, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0x9,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA4, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0x3, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0xB,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA5, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0x6, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0x1E,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA6, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0x9, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0x55,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA7, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0xC, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0x50,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA8, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0xF, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	},
	{
		0x12345678,
		0x1D,
		0x0,
		{ 0x71, 0x90, 0xf1, 0xA2, 0xA9, 0xffff, 0xffff, 0xffff },
		{ 0xFFFF, 0x12, 0x0, 0x0 },
		{ 0xFFFF, 0x1, 0x0, 0x0 },
		{ 0xFFFF, 0x2, 0x0, 0x0 }
	}
};


typedef struct {
	u16	unk_00;
	u8	unk_02[4];
} UnkStruct_ov104_0223FCB4;

static const UnkStruct_ov104_0223FCB4 Unk_ov104_0223FCB4[] = {
	{
		0x4,
		{ 0x0, 0x1, 0x2, 0x3 }
	},
	{
		0x14,
		{ 0x2, 0x3, 0x4, 0x5 }
	},
	{
		0x9,
		{ 0x4, 0x6, 0x6, 0x7 }
	},
	{
		0xA,
		{ 0x6, 0x7, 0x8, 0x9 }
	},
	{
		0x23,
		{ 0x8, 0x9, 0xA, 0xB }
	},
	{
		0xD,
		{ 0xB, 0xC, 0xD, 0xE }
	},
	{
		0x11,
		{ 0xD, 0xE, 0xF, 0x10 }
	}
};

void sub_02052894(BattleParams * param0);
BOOL ov104_0223A0C4(UnkStruct_0204AFC4 * param0, UnkStruct_ov104_0223A348 * param1, u16 param2, int param3, u16 * param4, u16 * param5, UnkStruct_0204B404 * param6, int param7);
void ov104_0223A30C(UnkStruct_021C0794 * param0, UnkStruct_ov104_0223A348 * param1, const u8 param2);
BattleParams * ov104_0223A580(UnkStruct_0204AFC4 * param0, UnkStruct_ov104_02230BE4 * param1);
void ov104_0223A734(UnkStruct_0204AFC4 * param0, u16 param1);
u16 ov104_0223A750(UnkStruct_0204AFC4 * param0, const u16 * param1);
int ov104_0223A768(u8 param0);
int ov104_0223A77C(u8 param0);
int ov104_0223A790(u8 param0);
static BOOL ov104_0223A118(UnkStruct_0204AFC4 * param0, UnkStruct_0204B184 * param1, u16 param2, UnkStruct_ov104_0223A348_sub2 * param3, u8 param4, u16 * param5, u16 * param6, UnkStruct_0204B404 * param7, int param8);
static void ov104_0223A348(UnkStruct_ov104_0223A348 * param0, const u8 param1);
static u32 ov104_0223A3A8(UnkStruct_0204AFC4 * param0, UnkStruct_ov104_0223A348_sub2 * param1, u16 param2, u32 param3, u32 param4, u8 param5, u8 param6, BOOL param7, int param8);
static u32 ov104_0223A700(u8 param0);
static void ov104_0223A6AC(BattleParams * param0, UnkStruct_ov104_0223A348 * param1, int param2, int param3, int param4);
static int ov104_0223A7AC(u8 param0);

BOOL ov104_0223A0C4 (UnkStruct_0204AFC4 * param0, UnkStruct_ov104_0223A348 * param1, u16 param2, int param3, u16 * param4, u16 * param5, UnkStruct_0204B404 * param6, int param7)
{
    BOOL v0 = 0;
    UnkStruct_0204B184 * v1;

    v1 = ov104_0222DD04(&param1->unk_00, param2, param7, ov104_0223A77C(param0->unk_0F));
    v0 = ov104_0223A118(param0, v1, param2, &param1->unk_30[0], param3, param4, param5, param6, param7);

    Heap_FreeToHeap(v1);

    return v0;
}

static BOOL ov104_0223A118 (UnkStruct_0204AFC4 * param0, UnkStruct_0204B184 * param1, u16 param2, UnkStruct_ov104_0223A348_sub2 * param3, u8 param4, u16 * param5, u16 * param6, UnkStruct_0204B404 * param7, int param8)
{
    int v0, v1;
    u8 v2;
    u8 v3;
    u32 v4;
    int v5;
    int v6[4];
    u32 v7[4];
    int v8;
    int v9;
    BOOL v10 = 0;
    UnkStruct_0204B1E8 v11;
    UnkStruct_0204B1E8 v12;

    GF_ASSERT(param4 <= 4);

    v8 = 0;
    v9 = 0;

    while (v8 != param4) {
        v3 = sub_0204AEC0(param0) % param1->unk_02;
        v5 = param1->unk_04[v3];

        ov104_0222DCF4(&v12, v5, ov104_0223A768(param0->unk_0F));

        for (v0 = 0; v0 < v8; v0++) {
            ov104_0222DCF4(&v11, v6[v0], ov104_0223A768(param0->unk_0F));

            if (v11.unk_00 == v12.unk_00) {
                break;
            }
        }

        if (v0 != v8) {
            continue;
        }

        if (param5 != NULL) {
            for (v0 = 0; v0 < param4; v0++) {
                if (param5[v0] == v12.unk_00) {
                    break;
                }
            }

            if (v0 != param4) {
                continue;
            }
        }

        if (v9 < 50) {
            for (v0 = 0; v0 < v8; v0++) {
                ov104_0222DCF4(&v11, v6[v0], ov104_0223A768(param0->unk_0F));

                if ((v11.unk_0C) && (v11.unk_0C == v12.unk_0C)) {
                    break;
                }
            }

            if (v0 != v8) {
                v9++;
                continue;
            }

            if (param6 != NULL) {
                for (v0 = 0; v0 < param4; v0++) {
                    if ((param6[v0] == v12.unk_0C) && (param6[v0] != 0)) {
                        break;
                    }
                }

                if (v0 != param4) {
                    v9++;
                    continue;
                }
            }
        }

        v6[v8] = v5;
        v8++;
    }

    v2 = sub_0204AE84(param2);
    v4 = (sub_0204AEC0(param0) | (sub_0204AEC0(param0) << 16));

    if (v9 >= 50) {
        v10 = 1;
    }

    for (v0 = 0; v0 < v8; v0++) {
        v7[v0] = ov104_0223A3A8(param0, &(param3[v0]), v6[v0], v4, 0, v2, v0, v10, param8);
    }

    if (param7 == NULL) {
        return v10;
    }

    param7->unk_00 = v4;

    for (v0 = 0; v0 < 2; v0++) {
        param7->unk_04[v0] = v6[v0];
        param7->unk_08[v0] = v7[v0];
    }

    return v10;
}

void ov104_0223A30C (UnkStruct_021C0794 * param0, UnkStruct_ov104_0223A348 * param1, const u8 param2)
{
    int v0;
    UnkStruct_0202D764 * v1;
    const UnkStruct_ov104_0223A348_sub1 * v2;
    const UnkStruct_ov104_0223A348_sub2 * v3;

    MI_CpuClear8(param1, sizeof(UnkStruct_ov104_0223A348));

    v1 = sub_0202D764(param0);

    if (!sub_0202D5E8(v1)) {
        ov104_0223A348(param1, param2);
        return;
    }

    sub_0202D63C(v1, param1, param2);
}

static void ov104_0223A348 (UnkStruct_ov104_0223A348 * param0, const u8 param1)
{
    int v0;
    const UnkStruct_ov104_0223A348_sub1 * v1;
    const UnkStruct_ov104_0223A348_sub2 * v2;
    const UnkStruct_ov104_0223FCB4 * v3;

    MI_CpuClear8(param0, sizeof(UnkStruct_ov104_0223A348));

    v1 = &(Unk_ov104_0223FCE0[param1]);
    v2 = Unk_ov104_0223FE30;
    v3 = &(Unk_ov104_0223FCB4[param1]);

    MI_CpuCopy8(v1, &param0->unk_00, sizeof(UnkStruct_ov104_0223A348_sub1));
    param0->unk_00.unk_06 = v3->unk_00;

    for (v0 = 0; v0 < 4; v0++) {
        MI_CpuCopy8(&(v2[v3->unk_02[v0]]), &(param0->unk_30[v0]), sizeof(UnkStruct_ov104_0223A348_sub2));
    }
}

static const u16 Unk_ov104_0223FCAC[] = {
    213, 157, 234, 217,
};

static u32 ov104_0223A3A8 (UnkStruct_0204AFC4 * param0, UnkStruct_ov104_0223A348_sub2 * param1, u16 param2, u32 param3, u32 param4, u8 param5, u8 param6, BOOL param7, int param8)
{
    int v0;
    int v1;
    u32 v2;
    u8 v3;
    UnkStruct_0204B1E8 v4;

    MI_CpuClear8(param1, sizeof(UnkStruct_ov104_0223A348_sub2));
    ov104_0222DCF4(&v4, param2, ov104_0223A768(param0->unk_0F));

    param1->unk_00_val1_0 = v4.unk_00;
    param1->unk_00_val1_11 = v4.unk_0E;

    if (param7) {
        param1->unk_02 = Unk_ov104_0223FCAC[param6];
    } else {
        param1->unk_02 = v4.unk_0C;
    }

    v3 = 255;

    for (v0 = 0; v0 < 4; v0++) {
        param1->unk_04[v0] = v4.unk_02[v0];

        if (v4.unk_02[v0] == 218) {
            v3 = 0;
        }
    }

    param1->unk_0C = param3;

    if (param4 == 0) {
        do {
            v2 = (sub_0204AEC0(param0) | sub_0204AEC0(param0) << 16);
        } while ((v4.unk_0B != GetNatureFromPersonality(v2)) || (sub_02075E38(param3, v2) == 1));

        param1->unk_10 = v2;
    } else {
        param1->unk_10 = param4;
        v2 = param4;
    }

    param1->unk_14_val1_0 = param5;
    param1->unk_14_val1_5 = param5;
    param1->unk_14_val1_10 = param5;
    param1->unk_14_val1_15 = param5;
    param1->unk_14_val1_20 = param5;
    param1->unk_14_val1_25 = param5;

    v1 = 0;

    for (v0 = 0; v0 < 6; v0++) {
        if (v4.unk_0A & sub_020787CC(v0)) {
            v1++;
        }
    }

    if ((510 / v1) > 255) {
        v1 = 255;
    } else {
        v1 = 510 / v1;
    }

    for (v0 = 0; v0 < 6; v0++) {
        if (v4.unk_0A & sub_020787CC(v0)) {
            param1->unk_18_val2[v0] = v1;
        }
    }

    param1->unk_1E_val2 = 0;
    param1->unk_1F = Unk_020E4C44;

    v0 = sub_020759F0(param1->unk_00_val1_0, 25);

    if (v0) {
        if (param1->unk_10 & 1) {
            param1->unk_20 = v0;
        } else {
            param1->unk_20 = sub_020759F0(param1->unk_00_val1_0, 24);
        }
    } else {
        param1->unk_20 = sub_020759F0(param1->unk_00_val1_0, 24);
    }

    param1->unk_21 = v3;
    sub_0200B274(param1->unk_00_val1_0, param8, &(param1->unk_22[0]));

    return v2;
}

BattleParams * ov104_0223A580 (UnkStruct_0204AFC4 * param0, UnkStruct_ov104_02230BE4 * param1)
{
    int v0;
    u8 v1;
    u32 v2;
    BattleParams * v3;
    UnkStruct_021C0794 * v4;
    Party * v5;
    Pokemon * v6;

    v3 = sub_02051D8C(param0->unk_04, ov104_0223A700(param0->unk_0F));
    v4 = param1->unk_08;
    v5 = Party_GetFromSavedata(v4);

    sub_020521B8(v3, NULL, param1->unk_08, param1->unk_1C, param1->unk_0C, param1->unk_10, param1->unk_20);

    v3->unk_128 = 18;
    v3->unk_12C = 18;

    v6 = AllocMonZeroed(param0->unk_04);
    v1 = 50;

    Party_InitWithCapacity(v3->parties[0], param0->unk_0E);

    for (v0 = 0; v0 < param0->unk_0E; v0++) {
        sub_020775EC(Party_GetPokemonBySlotIndex(v5, param0->unk_2A[v0]), v6);

        if (GetMonData(v6, MON_DATA_161, NULL) > v1) {
            v2 = sub_02075AD0(GetMonData(v6, MON_DATA_SPECIES, NULL), v1);

            sub_02074B30(v6, 8, &v2);
            sub_0207418C(v6);
        }

        sub_0205213C(v3, v6, 0);
    }

    Heap_FreeToHeap(v6);
    sub_02052894(v3);

    ov104_0223A6AC(v3, &(param0->unk_78[0]), param0->unk_0E, 1, param0->unk_04);

    for (v0 = 0; v0 < 4; v0++) {
        v3->trainerData[v0].unk_0C = (0x1 | 0x2 | 0x4);
    }

    switch (param0->unk_0F) {
    case 2:
        ov104_0223A6AC(v3, &(param0->unk_298[param0->unk_10_5]), param0->unk_0E, 2, param0->unk_04);
    case 3:
    case 6:
        ov104_0223A6AC(v3, &(param0->unk_78[1]), param0->unk_0E, 3, param0->unk_04);
        break;
    default:
        break;
    }

    return v3;
}

static void ov104_0223A6AC (BattleParams * param0, UnkStruct_ov104_0223A348 * param1, int param2, int param3, int param4)
{
    int v0, v1;
    Pokemon * v2;

    ov104_0222E284(param0, &param1->unk_00, param2, param3, param4);
    v2 = AllocMonZeroed(param4);

    for (v0 = 0; v0 < param2; v0++) {
        ov104_0222DF40(&param1->unk_30[v0], v2, 120);
        Party_AddPokemon(param0->parties[param3], v2);
    }

    Heap_FreeToHeap(v2);
}

static u32 ov104_0223A700 (u8 param0)
{
    switch (param0) {
    case 0:
    case 4:
        return (0x0 | 0x1) | 0x80;
    case 1:
        return (0x2 | 0x1) | 0x80;
    case 2:
        return ((0x2 | 0x1) | 0x8 | 0x40) | 0x80;
    case 3:
    case 6:
        return (((0x4 | 0x1) | 0x2) | 0x8) | 0x80;
    }

    return (0x0 | 0x1) | 0x80;
}

void ov104_0223A734 (UnkStruct_0204AFC4 * param0, u16 param1)
{
    param0->unk_10_3 = param1;
    param0->unk_83E[0] = param1;
}

u16 ov104_0223A750 (UnkStruct_0204AFC4 * param0, const u16 * param1)
{
    int v0;

    if (param0->unk_10_3 || param1[0]) {
        return 1;
    }

    return 0;
}

int ov104_0223A768 (u8 param0)
{
    if (ov104_0223A7AC(param0) == 0) {
        return 135;
    }

    return 179;
}

int ov104_0223A77C (u8 param0)
{
    if (ov104_0223A7AC(param0) == 0) {
        return 134;
    }

    return 178;
}

int ov104_0223A790 (u8 param0)
{
    if (ov104_0223A7AC(param0) == 0) {
        return 613;
    }

    return 614;
}

static int ov104_0223A7AC (u8 param0)
{
    UnkStruct_02025E6C * v0;
    UnkStruct_02025E6C * v1;
    u8 v2, v3;

    switch (param0) {
    case 3:
    case 6:
        v0 = sub_02032EE8(0);

        if (v0 == NULL) {
            GF_ASSERT(0);
        }

        v1 = sub_02032EE8(1);

        if (v1 == NULL) {
            GF_ASSERT(0);
        }

        v2 = sub_02025FCC(v0);
        v3 = sub_02025FCC(v1);

        if ((v2 == 0) || (v3 == 0)) {
            return 0;
        }

        return 1;
    }

    return 1;
}
